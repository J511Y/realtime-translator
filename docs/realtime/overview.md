# OpenAI Realtime API 2025 개요

**OpenAI Realtime API**는 낮은 지연 시간의 실시간 음성 및 텍스트 상호작용을 위해 설계된 차세대 AI 대화 API입니다. 브라우저 환경에서는 **WebRTC**, 서버 환경에서는 **WebSocket**을 사용합니다.

## 1. 연결 방식 비교

### WebRTC (브라우저/모바일 권장)

- **장점**: 낮은 지연 시간, P2P 연결, 네트워크 적응성 우수
- **용도**: 웹 브라우저, React Native, Flutter 앱
- **보안**: Ephemeral Token 사용으로 API Key 노출 방지
- **지연 시간**: 첫 응답 120-220ms (텍스트), 200-350ms (음성)

### WebSocket (서버-서버)

- **장점**: 구현 단순, 광범위한 지원, 세밀한 제어 가능
- **용도**: Node.js 서버, Python 백엔드, 제어된 환경
- **보안**: 서버에서 직접 API Key 사용
- **URL**: `wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview`

## 2. 핵심 아키텍처

### 인증 및 보안

- **서버-서버**: `Authorization: Bearer API_KEY` + `OpenAI-Beta: realtime=v1` 헤더
- **브라우저**: 서버에서 발급한 **Ephemeral Token** 사용 (단기 유효)
- **API Key 노출 금지**: 클라이언트 코드에 절대 직접 포함하지 않음

### 오디오 처리 최적화

- **입력 포맷**: PCM16 16kHz Mono (권장) 또는 Opus
- **출력 포맷**: Opus (최저 지연시간), MP3, WAV 지원
- **청크 크기**: Base64 인코딩 시 15-50KB per message
- **압축**: Opus 사용 시 대역폭 65% 절약, 100-150ms 지연시간 단축

## 3. 실시간 최적화 기능

### Voice Activity Detection (VAD)

- **서버 VAD**: `turn_detection: 'server_vad'` 설정
- **자동 턴 종료**: 사용자 발화 끝을 자동 감지
- **중복 방지**: 동시 말하기 상황 최소화

### 지연시간 최적화

- **스트리밍**: 텍스트/음성을 실시간 델타로 전송
- **지연 힌트**: `latency_hints: 'low' | 'balanced' | 'high'`
- **지역 선택**: 사용자와 가까운 리전 사용으로 95th percentile 18% 개선

## 4. 기능 확장성

### Function Calling

- **도구 정의**: Chat Completions와 동일한 JSON Schema 구조
- **실시간 실행**: 음성 중 함수 호출 및 결과 반영
- **성능**: 도구 개수에 따라 20-60ms 오버헤드 추가

### 모달리티 지원

- **텍스트 + 음성**: 동시 스트리밍 가능
- **음성 특성**: 감정, 톤, 속도 보존
- **언어**: 다국어 실시간 번역 지원

## 5. 에러 처리 및 모니터링

### 주요 에러 코드

- **401**: API Key 또는 Beta 헤더 오류
- **413**: 오디오 청크 크기 초과
- **409**: 세션 상태 충돌 (동시 요청)
- **429**: 요청 빈도 제한 초과

### 연결 안정성

- **Ping/Pong**: 15-25초 간격으로 연결 상태 확인
- **재연결**: 지수 백오프 (0.5s → 1s → 2s → 4s, 최대 10s)
- **버퍼 관리**: 큐 크기 모니터링으로 백프레셔 방지

## 6. 성능 벤치마크 (2025)

### 지연시간 측정 결과

- **첫 토큰**: 평균 120-220ms (텍스트)
- **첫 음성**: 평균 200-350ms (Opus), +80-120ms (MP3)
- **WebRTC vs WebSocket**: WebRTC가 불안정한 네트워크에서 30% 더 안정적

### 최적화 권장사항

1. **Opus 코덱** 우선 사용
2. **서버 VAD** 활성화
3. **청크 스트리밍** 구현
4. **도구 최소화** (필요한 것만 등록)
5. **지역별 엔드포인트** 활용
